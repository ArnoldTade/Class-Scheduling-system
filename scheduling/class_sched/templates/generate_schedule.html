
{% include "_header.html" %} {% load static %} 
{% block content %}


{% if messages %}
  <div class="messages">
    {% for message in messages %}
      <div class="alert {% if message.tags %}alert-{{ message.tags }}"{% endif %}>
        {{ message }}
      </div>
    {% endfor %}
  </div>
{% endif %}


<h4 class="text-start text-schedule">Generate Schedule</h4>
<hr>


<div class="container-fluid container-subject-page">
    <p class="text-center fs-5">Select College, School year and Semester to generate schedule </p>
    <nav>
        <div class="nav nav-tabs" id="nav-tab" role="tablist">
            <div class="row">
                <div class="col-sm">
                    <select class="form-select" id="category-college" style="width:auto;" aria-label="Default select example">
                        <option value="all" selected>All Colleges</option>
                        <option value="CAS">CAS</option>
                        <option value="CBA">CBA</option>
                        <option value="CIT">CIT</option>
                        <option value="CTED">CTED</option>
                        <option value="CCJE">CCJE</option>
                        <option value="CAF">CAF</option>
                    </select>
                </div>
                <div class="col-sm">
                    <input class="form-control" type="text" name="year" id="id_year" aria-label="default input example" required placeholder="Enter School Year">
                </div>
                <div class="col-sm">
                    <select class="form-select" id="category-semester" style="width:auto;" aria-label="Default select example">
                        <option value="1st Semester" selected>1st Semester</option>
                        <option value="2nd Semester">2nd Semester</option>
                    <option value="Summer">Summer</option>

                    </select>
                </div>
            </div>
        </div>
    </nav>
</div> 

<!-- Faculty Info -->
<section class="section-generate">
    <div class="container-fluid table-responsive container-generate-schedule">
        <table class="table table-hover table-striped caption-top align-middle">
            <caption><p class="text-start">Set Handled Subjects for each Faculty</p></caption>
            <caption>
                <div class="col-sm-3">
                    <input class="form-control" type="text"  id="searchFaculty" aria-label="default input example" placeholder="Search Faculty">
                </div>
            </caption> 
                <thead class="table-warning sticky-sm-top">
                <tr> 
                    <th scope="col">Profile</th>
                    <th scope="col">Name</th>
                    <th scope="col">College</th>
                    <th scope="col">Status</th>
                    <th scope="col">Handled Subjects</th>
                    <!--<th scope="col">Handled Sections</th>-->
                    <th scope="col">Total hours</th>
                    <th scope="col">Action</th> 
                </tr>
                </thead>
                <tbody id="course-table-body">
                {% for instructor in instructors  %}
                    <tr data-college="{{ instructor.college }}">
                        <th scope="row">
                        <img src="{{ instructor.profile_picture.url }}" style="width: 50px; height: 50px; border-radius: 50%"/>
                        </th>
                        <td>
                      {{ instructor.lastName }},  {{ instructor.firstName }} 
                        </td> 
                        <td>{{ instructor.college }}</td>
                        <td>{{ instructor.status }}</td>
                        <td>
                            <select id="id_course_handled_page" class="form-select form-handle-subject-page" name="course_handled" readonly >
                                {% for course in instructor.course_handled.all %}
                                <option value="{{ course.course_name }}">{{ course.course_name }}</option>
                                {% endfor %}
                            </select>
                        </td>  
                         
                        <!--NEED FIXING--> 
                        <!--
                        <td>  
                            <select id="id_section_handled_page" class="form-select form-handle-section-page" name="section_handled" readonly >
                                
                                {% for instructor_course in instructor_courses %}
                                    {% for section in instructor.course.sections.all %}
                                        <option value="{{ section.program_section }}">{{ section.program_section }}</option>
                                    {% endfor %}
                                {% endfor %}
                            </select>
                        </td> 
                        -->
                        <td>.</td>
                           
                        <td>
                        <a href="{% url 'deleteinstructor' id=instructor.id %}" type="button" class="btn btn-danger btn-sm"  onclick="return confirm('Are you sure you want to delete this account?');"><i class="bi bi-trash-fill"></i></a>
                        <a href="{% url 'editgenerate-schedule' id=instructor.id %}" type="button" class="btn btn-secondary btn-sm" id="buttonEdit" data-bs-target="#myTab" style="color:#fff;"><i class="bi bi-pen-fill"></i></a>
                        </td>
                    </tr>
                {% endfor %}
                
                </tbody>
        </table>
    </div>
</section>

<hr>
<section class="section-create-schedules">
    <div class="container-fluid container-generate-schedule">
            <p class="text-start fs-5">Generate Schedule for:</p>
            <form method="POST" action="{% url 'generateschedules' %}"  id="myForm" enctype="multipart/form-data" >
                {% csrf_token %}
                <div class="row">
                    <div class="col-sm">
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" name="college" id="floatingInputCollege" value="" placeholder="College">
                            <label for="floatingInput">College </label>
                        </div>
                    </div>
                    <div class="col-sm">
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" name="schoolYear" id="floatingInputSchoolYear" value="" placeholder="College">
                            <label for="floatingInput">School Year </label>
                        </div>
                    </div>
                    <div class="col-sm">
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" name="semester" id="floatingInputSemester" value="" placeholder="College">
                            <label for="floatingInput">Semester </label>
                        </div>
                    </div>
                   
                </div>

                <button class="btn btn-success" type="submit" id="generateScheduleBtn">
                    <span class="spinner-border spinner-border-sm d-none" id="spinner" aria-hidden="true"></span>
                    <span id="buttonText">Test Generate Schedule</span>
                </button>
                <!--
                <button class="btn btn-success invisible disabled" id="generateScheduleBtn">
                    <span class="spinner-border spinner-border-sm d-none" id="spinner" aria-hidden="true"></span>
                    <span id="buttonText">Generate Schedule</span>
                </button>
                -->
               

            </form>
                
    </div>
</section>
<br>
  

<script src="{% static 'js/jquery.min.js' %}"></script>
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>

<!-- Button Loading when clicked
<script>
    document.getElementById("generateScheduleBtn").addEventListener("click", function() {
        var spinner = document.getElementById("spinner");
        var buttonText = document.getElementById("buttonText");
        var button = document.getElementById("generateScheduleBtn");
  
        spinner.classList.toggle("d-none");
        
        if (spinner.classList.contains("d-none")) {
            buttonText.textContent = "Generate Schedule";
        } else {
            buttonText.textContent = "Loading...";
        }
        button.disabled = true;
    });
</script>
-->
<script>
    document.querySelectorAll('.form-select').forEach(function(select) {
        select.addEventListener('change', function() {
            filterTable();
        });
    });

    function filterTable() {
        var selectedCollege = document.getElementById('category-college').value;
        var rows = document.querySelectorAll('#course-table-body tr');
        var generateBtn = document.getElementById('generateScheduleBtn');
        rows.forEach(function(row) {
            var college = row.getAttribute('data-college');
            var collegeMatch = (selectedCollege === 'all' || college === selectedCollege);
            if (collegeMatch) {
                row.style.display = '';
                generateBtn.disabled = false;

            } else {
                row.style.display = 'none';
                generateBtn.disabled = true;
            }
        });
    }
</script>

<script>
    const collegeSelect = document.getElementById('category-college');
    const yearInput = document.getElementById('id_year');
    const semesterSelect = document.getElementById('category-semester');
    const collegeInput = document.getElementById('floatingInputCollege');
    const yearInputField = document.getElementById('floatingInputSchoolYear');
    const semesterInput = document.getElementById('floatingInputSemester');

    collegeSelect.addEventListener('change', updateCollege);
    yearInput.addEventListener('input', updateYear);
    semesterSelect.addEventListener('change', updateSemester);

    function updateCollege() {
        collegeInput.value = collegeSelect.options[collegeSelect.selectedIndex].text;
    }
    function updateYear() {
        yearInputField.value = yearInput.value;
    }

    function updateSemester() {
        semesterInput.value = semesterSelect.options[semesterSelect.selectedIndex].text;
    }

    updateCollege();
    updateYear();
    updateSemester();
</script>
<!-- SEARCH JS -->
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const searchInput = document.getElementById('searchFaculty');
        const tableRows = document.querySelectorAll('#course-table-body tr');

        searchInput.addEventListener('input', function() {
            const searchText = this.value.trim().toLowerCase();
            tableRows.forEach(row => {
                const lastName = row.querySelector('td:nth-child(2)').textContent.trim().toLowerCase();
                if (lastName.includes(searchText)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });
    });
</script>
 
 
{% endblock %}
{% include "_footer.html" %}
