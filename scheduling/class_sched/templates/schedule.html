{% include "_header.html" %} {% load static %} 
{% block content %}
 


<h4 class="text-start text-schedule">Schedule Page</h4>
<hr>
<div class="container-fluid container-schedule-page">
    <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home-tab-pane" type="button" role="tab" aria-controls="home-tab-pane" aria-selected="true"><i class="bi bi-calendar-week"></i>View Schedules</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile-tab-pane" type="button" role="tab" aria-controls="profile-tab-pane" aria-selected="false"><i class="bi bi-calendar3"></i>Generate Schedule</button>
        </li>
    </ul>
        <!--View Schedule Tab-->
    <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade show active" id="home-tab-pane" role="tabpanel" aria-labelledby="home-tab" tabindex="0">
            <div class="row row-schedule-panel">
                <!--Select College-->
                <div class="row">
                    <div class="col-5"> 
                        <select class="form-select schedule-department-select" aria-label="Default select example">
                            <option selected>Select College</option>
                            <option value="CAS">College of Arts and Sciences</option>
                            <option value="CBA">College of Business Administration</option>
                            <option value="CIT">College of Insdustrial Technology</option>
                            <option value="CTED">College of Teacher Education</option>
                            <option value="CCJE">College of Criminal Justice Education</option>
                            <option value="CAF">College of Agriculture and Forestry</option>
                        </select>
                        <button class="btn btn-secondary" type="button" data-bs-toggle="modal" data-bs-target="#addScheduleModal">Manually Add New Schedule</button>

                    </div>
                </div>
                <!--Instructor Carousel-->
                    <div class="owl-carousel owl-theme"> 
                        {% for instructor in instructors %}
                        <a href="{% url 'instructorschedule' id=instructor.id %}" class="schedule-link">
                            <div class="item">
                                <img src="{{ instructor.profile_picture.url }}" class="card-img-top" alt="...">
                                <p class="fs-6 text-center">{{ instructor.firstName }}, {{ instructor.lastName }}</p>
                            </div>
                        </a>
                        {% endfor %}
                    </div>
            </div> 
 
            <!--User Schedule Tab-->
            <hr>
            <div class="row row-user-info">
                <div class="container-fluid container-user-info" id="instructor-info">
                    <h4>User Schedule</h4>
                        <!--Table View Tab-->
                        <div class="container-fluid table-responsive container-instructor-schedule" id="ViewSchedules">
                                <table class="table table-hover table-striped caption-top">
                                    <thead class="table-info">
                                      <tr>
                                        <th scope="col">Course</th>
                                        <th scope="col">Instructor</th>
                                        <th scope="col">Room</th>
                                        <th scope="col">Time</th>
                                        <th scope="col">Days of Week</th>
                                        <th scope="col">Semester</th>
                                        <th scope="col">Year</th>
                                        <th scope="col">Action</th>
                                      </tr>
                                    </thead> 
                                    <tbody>
                                      {% for schedule in instructorSchedule %}
                                      <tr>
                                        <td>{{ schedule.course.course_name }}</td>
                                        <td>
                                          <img
                                            src="{{ schedule.instructor.profile_picture.url }}"
                                            style="width: 50px; height: 50px; border-radius: 50%"
                                          /> 
                                          {{ schedule.instructor.firstName }}, {{ schedule.instructor.lastName }}
                                        </td>
                                        <td>{{ schedule.room.room_name }}</td>
                                        <td>{{ schedule.start_time }} - {{ schedule.end_time }}</td>
                                        <td>{{ schedule.days_of_week }}</td>
                                        <td>{{ schedule.semester }}</td>
                                        <td>{{ schedule.year }}</td>
                                        <td>
                                          <button type="button" class="btn btn-danger"  onclick="return confirm('Are you sure you want to delete?');"><i class="bi bi-trash-fill"></i></button>
                                          <button type="button" class="btn btn-info" id="buttonEdit" ><i class="bi bi-pen-fill" style="color:#fff;"></i></button>
                                        </td>
                                      </tr>
                                      {% endfor %}
                                    </tbody>
                                </table> 
                        </div>
                        <!--Calendar View Tab-->
                        <div class="container-fluid container-schedule-calendar">
                            <div id='calendarSchedulePage'></div>
                        </div>
                        <!--Loadslip View Tab-->
                        <div class="container-fluid container-schedule-loadslip">
                            <h1>Loadslip</h1>
                        </div>                       
                </div>
            </div>
        </div>

        <!--Generate Schedule Tab-->

        <div class="tab-pane fade" id="profile-tab-pane" role="tabpanel" aria-labelledby="profile-tab" tabindex="0">
          <div class="container-fluid">
            <div class="col-sm">
              <!--
              <select class="form-select generate-select-semester" id="generate-schedule-semester" aria-label="Default select example">
                <option selected>Select Semester</option>
                <option value="First Semester">First Semester</option>
                <option value="Second Semester">Second Semester</option>
                <option value="Summer">Summer</option>
              </select>

              <label for="schoolYear">Select School Year:</label>
              <input type="number" id="schoolYear1" name="schoolYear1" min="2020" max="2100" step="1" onchange="handleYearChange()"> - 
              <input type="number" id="schoolYear2" name="schoolYear2" min="2020" max="2100" step="1" onchange="handleYearChange()">
            </div>
            -->
           
          
              <!--
            <a href="{% url 'generateschedules' %}" type="button" class="btn btn-success">Final Generate Schedules</a> 
            -->
            <a href="{% url 'generateschedules' %}" id="generateScheduleBtn" class="btn btn-primary" type="button">
              <span class="spinner-border spinner-border-sm d-none" id="spinner" aria-hidden="true"></span>
              <span id="buttonText">Generate Schedule</span>
            </a>


        </div>

    </div>
</div>

  <!-- Modal Add Schedule-->
  <div class="modal fade" id="addScheduleModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="staticBackdropLabel">Add New Schedule </h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <br>

            <!--Add Schedule Form-->
          <form method="POST" enctype="multipart/form-data" class="row g-3 needs-validation" novalidate>
              {% csrf_token %}
              <!-- {{ scheduleform.as_p }} --> 
              <div class="row">
                <div class="col-sm">
                  <select class="form-select mb-4 select-subject-name" name="course" id="id_course" style="width:auto;" aria-label="Default select example">
                    <option selected>Select Subject Name</option>
                    {% for course in courses %}
                    <option value="{{ course.id }}" {% if course.id == scheduleform.instance.course.id %} selected {% endif %}>{{ course.course_name }}</option>
                    {% endfor %}
                  </select>
                </div>
              
                <div class="col-sm">
                  <select class="form-select mb-4 select-subject-instructor" name="instructor" id="id_instructor" style="width:auto;" aria-label="Default select example">
                    <option selected>Select Instructor</option>
                    {% for instructor in instructors %}
                    <option value="{{ instructor.id }}" {% if instructor.id == scheduleform.instance.instructor_id %} selected {% endif %}>
                      {{ instructor.firstName }} {{ instructor.lastName }}
                    </option>
                    {% endfor %}
                  </select>
                </div>  
              </div>  
              <div class="row">
                <div class="col-sm">
                  <select class="form-select mb-4 select-subject-room" name="room" id="id_room" aria-label="Default select example">
                    <option selected>Select Room</option>
                    {% for room in rooms %}
                    <option value="{{ room.id }}" {% if room.id == scheduleform.instance.room.id %} selected {% endif %}>{{room.room_name}}</option>
                    {% endfor %}
                  </select>
                </div>  
              </div>  
            
            
            <div class="form-floating mb-3">
              <input type="time" class="form-control" name="start_time" id="id_start_time" placeholder="Start Time" required>
              <label for="id_start_time">Start Time</label>
              <div class="invalid-feedback">
                Please Enter Start Time.
              </div>
            </div>

            <div class="form-floating mb-3">
              <input type="time" class="form-control" name="end_time" id="id_end_time" placeholder="End Time" required>
              <label for="id_end_time">End Time</label>
              <div class="invalid-feedback">
                Please Enter End Time.
              </div>
            </div>

            <div class="form-floating mb-3">
              <input type="text" class="form-control" name="days_of_week" id="id_days_of_week" placeholder="Days of Week" required>
              <label for="id_days_of_week">Days of Week</label>
              <div class="invalid-feedback">
                Please Enter Days of Week.
              </div>
            </div>

            <div class="form-floating mb-3">
              <input type="text" class="form-control" name="semester" id="id_semester" placeholder="Semester" required>
              <label for="id_semester">Semester</label>
              <div class="invalid-feedback">
                Please Enter Semester.
              </div>
            </div>

            <div class="form-floating mb-3">
              <input type="text" class="form-control" name="year" id="id_year" placeholder="Year" required>
              <label for="id_year">Year</label>
              <div class="invalid-feedback">
                Please Enter Year.
              </div>
            </div>
               
        </div>
     
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-success" >Save</button>
        </div>
      </form>
      </div>
    </div>
</div>




<script src="{% static 'js/jquery.min.js' %}"></script>
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>

<script>
  var eventSchedules = {{ eventSchedules | safe }};

</script>
<script>
  document.getElementById("generateScheduleBtn").addEventListener("click", function() {
      var spinner = document.getElementById("spinner");
      var buttonText = document.getElementById("buttonText");
      var button = document.getElementById("generateScheduleBtn");

      spinner.classList.toggle("d-none");
      
      if (spinner.classList.contains("d-none")) {
          buttonText.textContent = "Generate Schedule";
      } else {
          buttonText.textContent = "Loading...";
      }
      button.disabled = true;
  });
</script>

{% endblock %}
{% include "_footer.html" %}

